# Mapping file for the CORD19 metadata CSV file. The article URIs are built using the sha field.
#
# Author: Franck MICHEL, University Cote d'Azur, CNRS, Inria
#
# Licensed under the Apache License, Version 2.0 (http://www.apache.org/licenses/LICENSE-2.0)

@prefix xrr:    <http://i3s.unice.fr/xr2rml#> .
@prefix rr:     <http://www.w3.org/ns/r2rml#> .
@prefix rml:    <http://semweb.mmlab.be/ns/rml#> .

@prefix rdf:    <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:   <http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:    <http://www.w3.org/2002/07/owl#>.
@prefix xsd:    <http://www.w3.org/2001/XMLSchema#> .

@prefix bibo:   <http://purl.org/ontology/bibo/> .
@prefix dce:    <http://purl.org/dc/elements/1.1/>.
@prefix dct:    <http://purl.org/dc/terms/>.
@prefix fabio:  <http://purl.org/spar/fabio/> .
@prefix eprint: <http://purl.org/eprint/type/> .
@prefix foaf:   <http://xmlns.com/foaf/0.1/>.
@prefix frbr:   <http://purl.org/vocab/frbr/core#>.
@prefix oa:     <http://www.w3.org/ns/oa#>.
@prefix prov:   <http://www.w3.org/ns/prov#>.
@prefix schema: <http://schema.org/>.
@prefix wd:     <http://www.wikidata.org/entity/>.

@prefix issa:  <http://data-issa.cirad.fr/>.
@prefix issapr:<http://data-issa.cirad.fr/property/>.

# Template file: replace placeholders
# - {{dataset}}: RDF dataset name e.g. "dataset-1-0"
# - {{collection}}: the MongoDB collection to query, e.g. document_metadata

<#LS>
    a           xrr:LogicalSource;
    xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} } )""".
    
<#TM>
    a rr:TriplesMap;
    xrr:logicalSource <#LS>;
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        
    #    rr:class    prov:Entity, fabio:ResearchPaper, schema:ScholarlyArticle, bibo:AcademicArticle, eprint:JournalArticle;
    ];

    # Provenance
    rr:predicateObjectMap [
        rr:predicate rdfs:isDefinedBy;
        rr:objectMap [ rr:constant issa:{{dataset}}; rr:termType rr:IRI ];
    ];
    
    rr:predicateObjectMap [
        rr:predicate prov:wasDerivedFrom;
		rr:objectMap [ xrr:reference "$.uri" ; rr:termType rr:IRI ];
    ];
    rr:predicateObjectMap [
        rr:predicate prov:generatedAtTime;
		rr:objectMap [ xrr:reference "$.datestamp" ; rr:datatype xsd:dateTime];
    ];


    # Publication
    rr:predicateObjectMap [
        rr:predicate dct:issued;
        rr:objectMap [ xrr:reference "$.year"; rr:datatype xsd:gYear ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:publication;
        rr:objectMap [ xrr:reference "$.publication" ];
    ];
    rr:predicateObjectMap [
        rr:predicate dct:source;
        rr:objectMap [ rr:constant "Agritrop-OAI2-API"; rr:termType rr:Literal ];
    ];
    rr:predicateObjectMap [
        rr:predicate dct:license;
        rr:objectMap [ xrr:reference "$.license_uri"; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate dct:rights;
        rr:objectMap [ rr:constant  "https://agritrop.cirad.fr/mention_legale.html"];
    ];
	rr:predicateObjectMap [
        rr:predicate dce:language;
        rr:objectMap [ xrr:reference "$.language" ];
    ];
	rr:predicateObjectMap [
        rr:predicate dct:language;
        rr:objectMap [ rr:template "http://id.loc.gov/vocabulary/iso639-1/{$.iso_lang}" ];
    ];

    # Identifiers
    rr:predicateObjectMap [
        rr:predicate dct:identifier;
        rr:objectMap [ xrr:reference "$.agritrop_id" ];
    ];
    rr:predicateObjectMap [
        rr:predicate bibo:doi;
        rr:objectMap [ xrr:reference "$.doi" ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:url;
        #rr:objectMap [ rr:template "https://doi.org/{$.doi}" ];
		rr:objectMap [ xrr:reference "$.uri" ; rr:termType rr:IRI ];
    ];
    rr:predicateObjectMap [
        rr:predicate schema:downloadUrl;
		rr:objectMap [ xrr:reference "$.pdf_url" ; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
        rr:predicate schema:sameAs;
		#rr:objectMap [ xrr:reference "$.same_as" ];
		rr:objectMap [ xrr:reference "JSONPath($.same_as)/JSONPath($.*)"; rr:termType rr:IRI ];
    ];
	rr:predicateObjectMap [
		rr:predicate dce:creator;
		#rr:objectMap [ xrr:reference "Column(authors)/JSONPath($.*)"; ];
		rr:objectMap [ xrr:reference "JSONPath($.authors)/JSONPath($.*)"; ];
	];

    # Parts title, abstract, body
    rr:predicateObjectMap [
        rr:predicate dct:title;
        rr:objectMap [ xrr:reference "$.title" ];
    ];
    rr:predicateObjectMap [
        rr:predicate issapr:hasTitle;
        rr:objectMap [ rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}#title"; ];
    ];
    rr:predicateObjectMap [
        rr:predicate dct:abstract;
        rr:objectMap [ rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}#abstract"; ];
    ];
    rr:predicateObjectMap [
        rr:predicate issapr:hasBody;
        rr:objectMap [ rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}#body_text"; ];
    ];
    .

# In a new version a document type can be more than an article.
# Below is the mapping of Agritrop types to known document ontologies types 
# it has to be queried separately
 
<#TM_type_article>
    a rr:TriplesMap;
    #xrr:logicalSource <#LS_type_article>;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "article" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:ResearchPaper, schema:ScholarlyArticle, bibo:AcademicArticle, eprint:JournalArticle;
    ].

<#TM_type_application>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "application" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:ComputerApplication;
    ].

<#TM_type_book>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "book" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:Book, eprint:Book;
    ].

<#TM_type_book_section>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "book_section" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:BookChapter, eprint:BookItem;
    ].

<#TM_type_conference_item>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "conference_item" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:ConferencePaper, eprint:ConferencePaper;
;
    ].

<#TM_type_film>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "film" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:Film;
    ].

<#TM_type_map>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "map" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, bibo:Map;
    ].

<#TM_type_monograph>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "monograph" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:Expression, bibo:Document;
    ].

<#TM_type_patent>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "patent" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:Patent, eprint:Patent;
    ].

<#TM_type_pgd>
    a rr:TriplesMap;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "pgd" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:DataManagementPlan;
    ].

<#TM_type_thesis>
    a rr:TriplesMap;
    #xrr:logicalSource <#LS_type_article>;
    xrr:logicalSource [xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: "thesis" } )""" ];
    rr:subjectMap   [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}";
        rr:class    prov:Entity, fabio:Thesis, eprint:Thesis;
    ].



# Article's text will be mapped separately from json files including title, abstract and body
# Here we map only non-article's title and abstract
 
<#LS_type_not_article>
    a           xrr:LogicalSource;
    xrr:query   """db.{{collection}}.find( { agritrop_id: {$exists: true} , type: {$ne : "article"} } )""".


<#TM_title>
    a rr:TriplesMap;
    xrr:logicalSource <#LS_type_not_article>;
    rr:subjectMap    [ rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}#title" ];
    rr:predicateObjectMap [
        rr:predicate frbr:partOf;
        rr:objectMap [ rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}"; ];
    ];
    rr:predicateObjectMap [
        rr:predicate rdf:value;
        rr:objectMap [ xrr:reference "$.title" ];
    ].

<#TM_abstract>
    a rr:TriplesMap;
    xrr:logicalSource <#LS_type_not_article>;
    rr:subjectMap    [
        rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}#abstract";
        rr:class    fabio:Abstract
    ];
    rr:predicateObjectMap [
        rr:predicate frbr:partOf;
        rr:objectMap [ rr:template "http://data-issa.cirad.fr/article/{$.agritrop_id}"; ];
    ];
    rr:predicateObjectMap [
        rr:predicate rdf:value;
        rr:objectMap [ xrr:reference "$.abstract" ];
    ].

    
